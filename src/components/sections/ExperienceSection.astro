---
import ExperienceCard from "../ui/ExperienceCard.astro";
import { fetchExperienceCards } from "../../lib/tina";

/**
 * Loading strategy (centralized):
 * - Use fetchExperienceCards() from src/lib/tina.ts which queries the generated Tina client,
 *   applies sorting (endDate/date, sentinel 9999 => Present), and returns normalized items.
 * - Tina-only (no DEV filesystem fallback) as requested.
 */
const experiences = await fetchExperienceCards({ first: 200 }) ?? [];
---
<section class="content-section">
	<h2 id="experience" class="page-h2">Experience</h2>
	<p class="section-desc">
		<strong>My professional journey and key achievements</strong>
	</p>
	<div class="experience-grid">
		{
			experiences.length > 0 ? experiences.map((exp) => (
				<div class="experience-item">
					<ExperienceCard item={exp} />
				</div>
			)) : null
		}
	</div>
</section>

<style>
	.page-h2 {
		font-family: var(--m3-font-family-display);
		font-size: var(--m3-font-headline-large);
		color: var(--m3-color-on-background);
		text-align: center;
		margin-bottom: 1rem;
	}

	.section-desc {
		font-size: var(--m3-font-body-large);
		color: var(--m3-color-on-surface-variant);
		text-align: center;
		margin-bottom: 4rem;
	}

	/* Ensure the section centers content the same way as Projects */
	.content-section {
		display: flex;
		flex-direction: column;
		align-items: center;
		padding: 4rem 2rem;
	}
	
	/* Experience-specific grid (mobile-first) with explicit guards to prevent global overrides */
	.experience-grid {
		display: grid !important;
		width: 100%;
		max-width: 1200px;
		margin: 0 auto;
		gap: 2rem;
		grid-template-columns: 1fr; /* base */
		justify-items: stretch;
		align-items: stretch;
		grid-auto-flow: row dense;
	}
	
	/* Prevent external/global styles from making children span all columns */
	.experience-grid > .experience-item {
		grid-column: auto !important;
		min-width: 0; /* avoid content overflow forcing new lines */
	}
	
	@media (min-width: 768px) {
		.experience-grid {
			grid-template-columns: repeat(2, minmax(0, 1fr)) !important;
		}
	}
	@media (min-width: 1024px) {
		.experience-grid {
			grid-template-columns: repeat(3, minmax(0, 1fr)) !important;
		}
	}
</style>
