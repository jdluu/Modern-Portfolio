---
import ProjectCardList from "@components/filters/ProjectCardList";
import ProjectCard from "@components/cards/ProjectCard.astro";
import ImagePriorityLoader from "@components/shared/ImagePriorityLoader.astro";
import { getCollection } from "astro:content";
import { mapProjectToCard } from "@lib/content-mappers";
import "./ProjectSection.css";


/**
 * Load projects collection at build time and normalize fields.
 */
const rawCollection = await getCollection("projects");
const projects = rawCollection.map(mapProjectToCard);
---

<section class="project-section content-section">
  <h2 id="projects" class="page-h2">Projects</h2>

  <!-- Client island -->
  <ProjectCardList client:visible initialItems={projects} />

  <!-- Server-rendered grid for SEO. Island controls visibility via data-slug. -->
  <div class="project-grid card-grid">
    {projects.map((p) => (
      <div class="project-item" data-slug={p.slug ?? ""}>
        <ProjectCard
          title={p.title}
          intro={p.description}
          thumbnail={p.thumbnail}
          url={p.slug}
        />
      </div>
    ))}
  </div>


  <div id="project-pagination-portal" class="experience-pagination-portal" aria-hidden="false"></div>


  <ImagePriorityLoader 
    containerSelector=".project-grid" 
    itemSelector=".project-item" 
    imgSelector=".project-image" 
  />
</section>
