---
import ProjectCard from "../ui/ProjectCard.astro";
import { getAllProjectCards } from "../../lib/cosmic";

/**
 * Load project cards at build-time and normalize into a small, explicit shape
 * so the template below stays simple and self-documenting.
 */
const rawProjects = (await getAllProjectCards()) || [];

function mapRawProject(raw: any) {
  return {
    title: raw?.title ?? "Untitled",
    slug: raw?.slug ?? "",
    description: raw?.metadata?.description ?? "",
    thumbnailUrl: raw?.metadata?.thumbnail?.url ?? "",
  };
}

const projects = rawProjects.map(mapRawProject);
---

<section class="content-section">
	<h2 id="projects" class="page-h2">Projects</h2>
	<div class="card-grid">
		{projects.map((p) => (
			<ProjectCard
				title={p.title}
				intro={p.description}
				thumbnail={p.thumbnailUrl}
				url={p.slug}
			/>
		))}
	</div>
</section>
