---
import BaseLayout from "../layouts/BaseLayout.astro";
import BlogSection from "../components/sections/BlogSection.astro";
import { getCollection as _getCollection } from "astro:content";
const getCollection: any = _getCollection;
import type { PostIndexItem } from "../types/post";
 
const title = "Blog";
 
// Build-time fetch: use Astro Content Collections
const rawPosts: any[] = (await getCollection("posts")) ?? [];
const posts: PostIndexItem[] = (rawPosts ?? [])
  .map((p: any) => {
    const slug = String(p.id ?? "").toLowerCase();
    return {
      title: p.data?.title ?? "Untitled",
      slug,
      date: p.data?.date ?? null,
      description: p.data?.description ?? "",
      tags: Array.isArray(p.data?.tags) ? p.data.tags.filter((t: any) => typeof t === "string") : [],
      draft: Boolean(p.data?.draft),
    } as PostIndexItem;
  })
  .filter((p: PostIndexItem) => !p.draft)
  .sort((a: PostIndexItem, b: PostIndexItem) => {
    const da = a.date ? new Date(a.date).getTime() : 0;
    const db = b.date ? new Date(b.date).getTime() : 0;
    return db - da;
  });
---
<BaseLayout title={title}>
  <BlogSection posts={posts} />
</BaseLayout>
