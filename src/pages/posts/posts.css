/* Two-column layout where the header spans the full width above the columns.
   This ensures the aside (hero) sits beside the main text row and aligns to the
   top of the text area (not the title/date). Links occupy a full-width row below. */
article.post-grid {
  max-width: 1200px;
  margin: 0 auto;
  padding: 5rem 2rem;
  background-color: var(--m3-color-surface);
  color: var(--m3-color-on-surface);
  display: grid;
  /* two equal columns (left text, right hero) */
  grid-template-columns: 1fr 1fr;
  grid-template-areas:
    "header header"
    "main   aside"
    "links  links";
  gap: 3.2rem;
  align-items: start;
  box-sizing: border-box;
}

.post-header {
  /* Place header in its own full-width row above columns so aside cannot affect its height.
     Visually it's left-aligned to match the main content column. */
  grid-area: header;
  margin: 0 0 3.2rem 0;
  text-align: left;
  align-self: start;
  max-width: min(80ch, 100%);
  display: flex;
  flex-direction: column;
  gap: 1.6rem;
}

/* Center header when there's no hero image - make it wider than content */
article.post-grid.no-hero .post-header {
  max-width: 110ch;
  width: 100%;
  margin-left: auto;
  margin-right: auto;
  text-align: center;
  align-items: center;
}

article.post-grid.no-hero .post-header-actions {
  justify-content: center;
  width: 100%;
}

/* Align header with main content when there is a hero image */
article.post-grid:not(.no-hero) .post-header {
  max-width: min(100ch, 100%);
  flex-direction: row;
  justify-content: space-between;
  align-items: flex-start;
}

.post-header-content {
  width: 100%;
}

.post-header-actions {
  display: flex;
  align-items: center;
  gap: 1.2rem;
}

.post-title {
  font-family: var(--m3-font-family-display);
  font-size: var(--m3-font-headline-large);
  color: var(--m3-color-primary);
  margin-bottom: 1.6rem;
  line-height: 1.2;
}

/* Center title text when no hero */
article.post-grid.no-hero .post-title {
  text-align: center;
}

.publish-date {
  font-family: var(--m3-font-family-body);
  font-size: var(--m3-font-label-large);
  color: var(--m3-color-on-surface-variant);
  margin-bottom: 0;
}

/* Center date text when no hero */
article.post-grid.no-hero .publish-date {
  text-align: center;
}

/* Copy as Markdown button */
.copy-markdown-btn {
  display: inline-flex;
  align-items: center;
  gap: 0.6rem;
  padding: 0.8rem 1.2rem;
  background-color: var(--m3-color-surface-variant);
  color: var(--m3-color-on-surface);
  border: 1px solid
    color-mix(in oklab, var(--m3-color-outline) 30%, transparent);
  border-radius: 8px;
  font-family: var(--m3-font-family-body);
  font-size: var(--m3-font-label-medium);
  font-weight: 500;
  cursor: pointer;
  transition: all 0.18s ease;
  white-space: nowrap;
}

.copy-markdown-btn:hover {
  background-color: var(--m3-color-primary-container);
  color: var(--m3-color-on-primary-container);
  border-color: var(--m3-color-primary);
  transform: translateY(-1px);
}

.copy-markdown-btn:active {
  transform: translateY(0);
}

.copy-markdown-btn:focus-visible {
  outline: 2px solid var(--m3-color-primary);
  outline-offset: 2px;
}

.copy-markdown-btn svg {
  width: 18px;
  height: 18px;
  flex-shrink: 0;
}

.copy-markdown-btn.copied {
  background-color: var(--m3-color-primary);
  color: var(--m3-color-on-primary);
  border-color: var(--m3-color-primary);
}

.copy-markdown-btn.copied .copy-markdown-text::after {
  content: "Copied!";
}

.copy-markdown-btn.copied .copy-markdown-text {
  opacity: 0;
  width: 0;
  overflow: hidden;
}

/* Hide text on mobile, show only icon */
@media (max-width: 600px) {
  .copy-markdown-btn {
    padding: 0.8rem;
  }

  .copy-markdown-text {
    display: none;
  }

  .copy-markdown-btn.copied .copy-markdown-text {
    display: none;
  }

  .copy-markdown-btn.copied::after {
    content: "Copied!";
    font-size: var(--m3-font-label-small);
  }
}

article.post-grid:not(.no-hero) .post-header-actions {
  flex-shrink: 0;
  margin-top: 0.4rem;
}

.main-content {
  grid-area: main;
  min-width: 0;
  width: 100%;
}

/* When there's no hero image, center the content and use full width */
article.post-grid.no-hero {
  grid-template-columns: 1fr;
  grid-template-areas:
    "header"
    "main"
    "links";
}

article.post-grid.no-hero .main-content {
  max-width: 75ch;
  margin: 0 auto;
}

article.post-grid.no-hero .prose {
  max-width: 100%;
  text-align: left;
}

.aside {
  grid-area: aside;
  display: flex;
  flex-direction: column;
  gap: 1.6rem;
  align-self: start; /* keep aside aligned to the top of the main column */
  width: 100%; /* fill the aside column */
}

.hero {
  width: 100%;
  max-height: min(
    60vh,
    480px
  ); /* allow the hero to be visually prominent while staying constrained */
  background-color: var(--m3-color-surface-variant);
  border-radius: 12px;
  overflow: hidden;
  margin: 0;
  border: 1px solid
    color-mix(in oklab, var(--m3-color-outline) 55%, transparent);
  display: block;
}

/* Ensure the image fills the hero box without stretching the layout */
.hero-trigger img {
  display: block;
  width: 100%;
  height: 100%;
  object-fit: cover;
}

.hero-trigger {
  all: unset;
  display: block;
  width: 100%;
  height: 100%;
  cursor: zoom-in;
}

.hero-trigger img {
  width: 100%;
  height: 100%;
  object-fit: cover;
  transition: transform 0.4s ease;
  display: block;
}

.hero-trigger:hover img {
  transform: scale(1.02);
}

.project-links {
  grid-area: links;
  margin-top: 1.2rem;
  padding-top: 1rem;
  border-top: 1px solid var(--m3-color-outline);
  display: flex;
  justify-content: center;
}

.project-links .links-container {
  display: flex;
  flex-direction: row;
  justify-content: center;
  gap: 1.2rem;
  flex-wrap: wrap;
  align-items: center;
  max-width: min(80ch, 900px);
  width: 100%;
  padding-inline: 0.8rem;
  box-sizing: border-box;
}

.aside-links {
  margin-top: 0;
}

.links-container {
  display: flex;
  flex-direction: column;
  gap: 0.8rem;
  align-items: stretch;
}

.project-link {
  display: inline-flex;
  align-items: center;
  gap: 0.8rem;
  padding: 0.9rem 1rem;
  border-radius: 12px;
  font-family: var(--m3-font-family-body);
  font-size: var(--m3-font-label-large);
  font-weight: 500;
  text-decoration: none;
  background-color: var(--m3-color-primary-container);
  color: var(--m3-color-on-primary-container);
  transition:
    background-color 0.18s,
    transform 0.12s;
  border: 1px solid transparent;
}

.project-link .link-label {
  display: inline-block;
}

.project-link .external-icon {
  width: 1.1rem;
  height: 1.1rem;
  color: currentColor;
  flex: 0 0 auto;
}

.project-link:hover {
  background-color: var(--m3-color-primary);
  color: var(--m3-color-on-primary);
  transform: translateY(-2px);
}

.project-link:focus-visible {
  outline: none;
  box-shadow:
    0 0 0 3px color-mix(in oklab, var(--m3-color-primary) 25%, transparent),
    0 0 0 6px color-mix(in oklab, var(--m3-color-primary) 12%, transparent);
  border-color: color-mix(in oklab, var(--m3-color-primary) 40%, transparent);
}

.prose {
  font-family: var(--m3-font-family-body);
  font-size: var(--m3-font-body-large);
  line-height: 1.75;
  color: var(--m3-color-on-surface);
  min-width: 0;
  max-width: 70ch; /* Optimal reading width */
  width: 100%;
  margin: 0; /* ensure left alignment within the left column */
}

/* First h1 in prose should have less top margin */
.prose > h1:first-child {
  margin-top: 0;
}

.prose h1 {
  font-family: var(--m3-font-family-display);
  font-size: var(--m3-font-headline-large);
  color: var(--m3-color-on-surface);
  margin-top: 4rem;
  margin-bottom: 2rem;
  font-weight: 600;
  line-height: 1.3;
  letter-spacing: -0.01em;
}

.prose h2,
.prose h3,
.prose h4 {
  font-family: var(--m3-font-family-display);
  color: var(--m3-color-on-surface);
  margin-top: 3.2rem;
  margin-bottom: 1.4rem;
  font-weight: 600;
  line-height: 1.4;
  letter-spacing: -0.008em;
}

.prose h2 {
  font-size: var(--m3-font-headline-medium);
}

.prose h3 {
  font-size: var(--m3-font-title-large);
  margin-top: 2.8rem;
  margin-bottom: 1.2rem;
}

.prose h4 {
  font-size: var(--m3-font-title-medium);
  margin-top: 2.4rem;
  margin-bottom: 1rem;
}

.prose p {
  margin-bottom: 1.8rem;
  color: var(--m3-color-on-surface);
}

.prose strong,
.prose b {
  font-weight: 600;
  color: var(--m3-color-on-surface);
}

.prose em,
.prose i {
  font-style: italic;
}

.prose a {
  color: var(--m3-color-primary);
  text-decoration: none;
  border-bottom: 1px solid transparent;
  transition:
    background-color 0.18s,
    color 0.18s,
    border-color 0.18s;
}

.prose a:hover {
  background-color: var(--m3-color-primary);
  color: var(--m3-color-on-primary);
  border-bottom-color: var(--m3-color-on-primary);
}

/* Lists */
.prose ul,
.prose ol {
  margin: 2rem 0;
  padding-left: 2.4rem;
  color: var(--m3-color-on-surface);
}

.prose li {
  margin: 0.6rem 0;
  line-height: 1.75;
}

.prose li:first-child {
  margin-top: 0;
}

.prose li:last-child {
  margin-bottom: 0;
}

.prose ul {
  list-style-type: disc;
}

.prose ol {
  list-style-type: decimal;
}

.prose ul ul,
.prose ol ol,
.prose ul ol,
.prose ol ul {
  margin: 0.8rem 0;
}

/* Code blocks */
.prose pre {
  background-color: var(--m3-color-surface-variant);
  border: 1px solid
    color-mix(in oklab, var(--m3-color-outline) 30%, transparent);
  border-radius: 8px;
  padding: 1.8rem;
  margin: 2.4rem 0;
  overflow-x: auto;
  font-family:
    "Monaco", "Menlo", "Ubuntu Mono", "Consolas", "source-code-pro", monospace;
  font-size: 1.4rem;
  line-height: 1.7;
  color: var(--m3-color-on-surface);
}

.prose code {
  font-family:
    "Monaco", "Menlo", "Ubuntu Mono", "Consolas", "source-code-pro", monospace;
  font-size: 0.9em;
}

.prose pre code {
  background: transparent;
  padding: 0;
  border: none;
  font-size: inherit;
  color: inherit;
}

/* Inline code */
.prose :not(pre) > code {
  background-color: var(--m3-color-surface-variant);
  color: var(--m3-color-primary);
  padding: 0.2em 0.4em;
  border-radius: 4px;
  font-size: 0.9em;
  border: 1px solid
    color-mix(in oklab, var(--m3-color-outline) 20%, transparent);
}

/* Blockquotes */
.prose blockquote {
  border-left: 4px solid var(--m3-color-primary);
  padding-left: 2rem;
  margin: 2.4rem 0;
  padding-top: 1rem;
  padding-bottom: 1rem;
  background-color: color-mix(
    in oklab,
    var(--m3-color-primary) 5%,
    transparent
  );
  border-radius: 0 8px 8px 0;
  font-style: italic;
  color: var(--m3-color-on-surface);
}

.prose blockquote p {
  margin-bottom: 0.8rem;
}

.prose blockquote p:last-child {
  margin-bottom: 0;
}

/* Horizontal rules */
.prose hr {
  border: none;
  border-top: 1px solid
    color-mix(in oklab, var(--m3-color-outline) 25%, transparent);
  margin: 4rem 0;
  background: none;
  height: 0;
}

/* Add extra spacing after hr when followed by h1 or h2 */
.prose hr + h1,
.prose hr + h2 {
  margin-top: 2.4rem;
}

/* Lightbox */
.lightbox {
  position: fixed;
  inset: 0;
  background-color: rgba(0, 0, 0, 0.75);
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 1.5rem;
  z-index: 1000;
}
.lightbox.is-hidden {
  display: none;
}
.lightbox-content {
  position: relative;
  outline: none;
  max-width: min(95vw, 1400px);
  max-height: 90vh;
}
.lightbox-content img {
  display: block;
  max-width: 100%;
  max-height: 90vh;
  width: auto;
  height: auto;
  object-fit: contain;
  border-radius: 12px;
  background-color: var(--m3-color-surface);
  box-shadow: 0 10px 30px rgba(0, 0, 0, 0.4);
}
.lightbox-close {
  position: absolute;
  top: 10px;
  right: 10px;
  width: 40px;
  height: 40px;
  border-radius: 999px;
  border: 1px solid var(--m3-color-outline);
  background-color: var(--m3-color-surface-variant);
  color: var(--m3-color-on-surface-variant);
  display: inline-flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
}
.lightbox-close:hover {
  background-color: var(--m3-color-primary);
  color: var(--m3-color-on-primary);
}

/* Mobile - single column, stacking order: Header → Image → Links → Text */
@media (max-width: 900px) {
  article.post-grid {
    grid-template-columns: 1fr;
    padding: 3.2rem 1.6rem;
    gap: 2.4rem;
    /* Mobile stacking order: Header → Image (aside) → Links → Text (main) */
    grid-template-areas:
      "header"
      "aside"
      "links"
      "main";
  }

  .prose {
    max-width: 100%;
  }

  .prose h1 {
    margin-top: 3.2rem;
  }

  .prose h2,
  .prose h3 {
    margin-top: 2.4rem;
  }

  .post-header {
    grid-area: header;
    text-align: left;
    max-width: 100%;
    margin-left: 0;
    margin-right: 0;
  }

  .post-header {
    flex-direction: column;
  }

  .post-header-actions {
    width: 100%;
  }

  .copy-markdown-btn {
    width: 100%;
    justify-content: center;
  }

  /* Restore normal flow for mobile */
  .aside {
    position: static;
    width: auto;
    grid-area: aside;
    margin: 0 0 1.6rem 0;
    align-self: stretch;
  }

  .main-content {
    grid-area: main;
    margin-right: 0; /* remove desktop reserved space */
  }

  .project-links {
    grid-area: links;
    margin-top: 1.6rem;
  }

  .links-container {
    flex-direction: row;
    flex-wrap: wrap;
    justify-content: center;
    gap: 0.8rem;
  }

  .project-link {
    padding: 0.8rem 1.2rem;
    border-radius: 999px;
  }

  .post-title {
    font-size: var(--m3-font-headline-medium);
  }
}

@media (prefers-reduced-motion: reduce) {
  .hero-trigger img,
  .project-link {
    transition: none !important;
  }
}
