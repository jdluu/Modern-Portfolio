---
import BaseLayout from "@layouts/BaseLayout.astro";
import { getCollection, render } from "astro:content";
import LightboxImage from "@components/ui/LightboxImage.astro";
import CopyToClipboard from "@components/ui/CopyToClipboard.astro";
import ProjectLinks from "@components/ui/ProjectLinks.astro";

import "./posts.css";

// Generate static paths
export async function getStaticPaths() {
  const posts = await getCollection("posts");
  const paths = (posts ?? [])
    .filter((p: any) => p.data?.draft !== true)
    .map((p: CollectionEntry<"posts">) => {
      const rawId = String(p.id ?? "");
      const clean = rawId.replace(/\.(md|mdx)$/, "").toLowerCase();
      return {
        params: { slug: clean },
        props: { post: p },
      };
    })
    .filter(Boolean);
  return paths;
}

import type { CollectionEntry } from "astro:content";

const { post } = Astro.props as { post: CollectionEntry<"posts"> };
const { Content } = await render(post);

const title = post?.data?.title ?? "Untitled";
const date = post?.data?.date ?? null;
const links = Array.isArray(post?.data?.links) ? post.data.links : [];
const displayDate = date
  ? new Date(date).toLocaleDateString("en-US", {
      year: "numeric",
      month: "long",
      day: "numeric",
      timeZone: "UTC",
    })
  : "";

const heroUrl = (post?.data?.hero as string) ?? null;
---

<BaseLayout title={title}>
  <article class={`post-grid ${!heroUrl ? 'no-hero' : ''}`}>
    <header class="post-header">
      <div class="post-header-content">
        <h1 class="post-title">{title}</h1>
        {date && <p class="publish-date">{displayDate}</p>}
        {links && links.length > 0 && (
          <div class="post-links-top">
            <ProjectLinks links={links} />
          </div>
        )}
      </div>
      <div class="post-header-actions">
        <CopyToClipboard targetSelector=".prose" />
      </div>
    </header>

    {heroUrl && (
      <LightboxImage src={heroUrl} alt={`${title} hero`} />
    )}

    <main class="main-content">
      <div class="prose"><Content /></div>


    </main>
 

 

  </article>


</BaseLayout>
